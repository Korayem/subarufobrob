// Designed using http://t-filter.engineerjs.com/
#include "filter.h"

#ifdef EXTREME_FILTER
static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
	0.002302072050431318,
	0.0019065566449508362,
	0.0025886962337881092,
	0.003334427897477679,
	0.004111434252486963,
	0.004878534872592076,
	0.0055863099535679705,
	0.006181863819829403,
	0.006610460819198167,
	0.006817857440897306,
	0.0067577565989259715,
	0.006390605412314506,
	0.0056930968650691915,
	0.004657171268544787,
	0.003294782034108345,
	0.00163833822144202,
	-0.00025907781015479446,
	-0.0023245121475296755,
	-0.004467977352190264,
	-0.006587127163922341,
	-0.008571563637938413,
	-0.01031029356461184,
	-0.011697495999091936,
	-0.012640655570865893,
	-0.013067337875898153,
	-0.012931465934320253,
	-0.012218435145251701,
	-0.01094818795423218,
	-0.009176381727762384,
	-0.006993687926995403,
	-0.004521996173769578,
	-0.0019091257300849387,
	0.0006792170488658403,
	0.003068971833422372,
	0.005088319023917031,
	0.006579425922970691,
	0.007409624245129881,
	0.007481998752721283,
	0.006744411188436674,
	0.005195884587062208,
	0.0028905119990360446,
	-0.00006180742469318218,
	-0.0034984766621290325,
	-0.007209653183530276,
	-0.01094846625151464,
	-0.014442935517474324,
	-0.017411117963312905,
	-0.019577308644681213,
	-0.020688190994287738,
	-0.02052874305563292,
	-0.018937225847487273,
	-0.015816588267185155,
	-0.011145783839109831,
	-0.004982465207104143,
	0.0025343736778526693,
	0.011190026965100323,
	0.020701506203338098,
	0.030728535605405276,
	0.04088959189431184,
	0.05078205093703156,
	0.05999784850019325,
	0.06815567761995442,
	0.07489929631061168,
	0.07994092547926865,
	0.0830572695997482,
	0.08411081733879823,
	0.0830572695997482,
	0.07994092547926865,
	0.07489929631061168,
	0.06815567761995442,
	0.05999784850019325,
	0.05078205093703156,
	0.04088959189431184,
	0.030728535605405276,
	0.020701506203338098,
	0.011190026965100323,
	0.0025343736778526693,
	-0.004982465207104143,
	-0.011145783839109831,
	-0.015816588267185155,
	-0.018937225847487273,
	-0.02052874305563292,
	-0.020688190994287738,
	-0.019577308644681213,
	-0.017411117963312905,
	-0.014442935517474324,
	-0.01094846625151464,
	-0.007209653183530276,
	-0.0034984766621290325,
	-0.00006180742469318218,
	0.0028905119990360446,
	0.005195884587062208,
	0.006744411188436674,
	0.007481998752721283,
	0.007409624245129881,
	0.006579425922970691,
	0.005088319023917031,
	0.003068971833422372,
	0.0006792170488658403,
	-0.0019091257300849387,
	-0.004521996173769578,
	-0.006993687926995403,
	-0.009176381727762384,
	-0.01094818795423218,
	-0.012218435145251701,
	-0.012931465934320253,
	-0.013067337875898153,
	-0.012640655570865893,
	-0.011697495999091936,
	-0.01031029356461184,
	-0.008571563637938413,
	-0.006587127163922341,
	-0.004467977352190264,
	-0.0023245121475296755,
	-0.00025907781015479446,
	0.00163833822144202,
	0.003294782034108345,
	0.004657171268544787,
	0.0056930968650691915,
	0.006390605412314506,
	0.0067577565989259715,
	0.006817857440897306,
	0.006610460819198167,
	0.006181863819829403,
	0.0055863099535679705,
	0.004878534872592076,
	0.004111434252486963,
	0.003334427897477679,
	0.0025886962337881092,
	0.0019065566449508362,
	0.002302072050431318
};
#else
static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
	-0.0034473462146292415,
	-0.005000451673234299,
	-0.007423581552162021,
	-0.009275547438522096,
	-0.009578136121711258,
	-0.007236543607181547,
	-0.0012434176693360227,
	0.009084549372884047,
	0.02388722821461575,
	0.0426143538369512,
	0.06399745041435487,
	0.08615195572896084,
	0.10680720614706975,
	0.12364241765392411,
	0.13465638205597324,
	0.13848416526155305,
	0.13465638205597324,
	0.12364241765392411,
	0.10680720614706975,
	0.08615195572896084,
	0.06399745041435487,
	0.0426143538369512,
	0.02388722821461575,
	0.009084549372884047,
	-0.0012434176693360227,
	-0.007236543607181547,
	-0.009578136121711258,
	-0.009275547438522096,
	-0.007423581552162021,
	-0.005000451673234299,
	-0.0034473462146292415
};
#endif

void SampleFilter_init(SampleFilter* f) {
	int i;
	for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
		f->history[i] = 0;
	f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
	f->history[f->last_index++] = input;
	if(f->last_index == SAMPLEFILTER_TAP_NUM)
		f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
	double acc = 0;
	int index = f->last_index, i;
	for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
		index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
		acc += f->history[index] * filter_taps[i];
	};
	return acc;
}

